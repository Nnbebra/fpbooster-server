{% extends "account_base.html" %}
{% block title %}–ö–∞–±–∏–Ω–µ—Ç ‚Äî FPBooster{% endblock %}

{% block head_extra %}
<style>
    /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 24px;
    }
    
    @media (max-width: 992px) {
        .dashboard-grid { grid-template-columns: 1fr; }
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: 0.3s;
    }
    .stat-card:hover {
        background: rgba(255, 255, 255, 0.06);
        transform: translateY(-2px);
    }
    .stat-icon {
        width: 45px; height: 45px;
        border-radius: 10px;
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem; color: white;
        box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏ */
    .license-card {
        position: relative;
        background: linear-gradient(145deg, #1a1a20, #101012);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 15px;
        overflow: hidden;
    }
    .license-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 4px; height: 100%;
        background: #444; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä—ã–π */
    }
    .license-card.active::before { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
    .license-card.expired::before { background: #ffcc00; }
    .license-card.banned::before { background: #ff4444; }

    .license-key {
        font-family: 'Courier New', monospace;
        font-size: 1.1rem;
        letter-spacing: 1px;
        font-weight: bold;
        color: #fff;
    }

    .action-btn-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 10px;
    }
    
    .btn-action {
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        color: #ccc;
        padding: 12px;
        border-radius: 10px;
        text-align: center;
        transition: 0.2s;
        display: flex; flex-direction: column; align-items: center; gap: 8px;
    }
    .btn-action i { font-size: 1.4rem; margin-bottom: 4px; color: var(--accent1); }
    .btn-action:hover {
        background: rgba(255,255,255,0.1);
        color: #fff;
        transform: translateY(-2px);
        border-color: var(--accent1);
    }

    /* –ë–ª–æ–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è */
    .hero-download {
        background: linear-gradient(135deg, rgba(106, 17, 203, 0.2), rgba(37, 117, 252, 0.2));
        border: 1px solid rgba(106, 17, 203, 0.4);
        border-radius: 16px;
        padding: 30px;
        text-align: center;
        margin-bottom: 24px;
        position: relative;
        overflow: hidden;
    }
    .hero-download i { font-size: 3rem; margin-bottom: 15px; background: -webkit-linear-gradient(#eee, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
</style>
{% endblock %}

{% block content %}
<section style="padding: 30px 0;">

    <div class="row mb-4">
        <div class="col-12">
            <div class="panel-glass card p-4">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                    <div class="d-flex align-items-center gap-3">
                        <div style="width:60px; height:60px; background: var(--gradient); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.8rem; font-weight:bold; color:white; box-shadow: 0 0 20px rgba(155, 75, 255, 0.4);">
                            {{ user.username[0]|upper }}
                        </div>
                        <div>
                            <h2 class="m-0" style="font-size:1.8rem;">{{ user.username }}</h2>
                            <div class="d-flex gap-2 align-items-center mt-1">
                                <span class="badge bg-dark border border-secondary text-muted">{{ user.user_group|upper }}</span>
                                <span class="badge bg-dark border border-secondary text-muted">UID: {{ user.uid }}</span>
                                {% if not user.email_confirmed %}
                                    <span class="badge bg-danger" title="Email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!"><i class="fa-solid fa-exclamation-circle"></i> Email</span>
                                {% else %}
                                    <span class="badge bg-success" title="Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"><i class="fa-solid fa-check"></i> OK</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-3">
                        <div class="text-end">
                            <div class="muted small">–í—Å–µ–≥–æ –ø–æ–∫—É–ø–æ–∫</div>
                            <div style="font-size:1.4rem; font-weight:bold; color:#00ff88;">{{ total_spent }} ‚ÇΩ</div>
                        </div>
                        <div class="text-end border-start border-secondary ps-3">
                            <div class="muted small">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
                            <div style="font-size:1.1rem; color:#fff;">{{ user.created_at.strftime("%d.%m.%Y") }}</div>
                        </div>
                    </div>
                </div>
                
                {% if not user.email_confirmed %}
                <div class="alert alert-warning mt-3 mb-0 d-flex align-items-center gap-2" style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); color: #ffc107;">
                    <i class="fa-solid fa-envelope"></i>
                    <span>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–∞—à Email ({{ user.email }}), —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤ —Å–ª—É—á–∞–µ –ø–æ—Ç–µ—Ä–∏ –ø–∞—Ä–æ–ª—è.</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        
        <div class="main-column">
            
            {% set has_active = licenses|selectattr("status", "equalto", "active")|list %}
            
            {% if has_active %}
                <div class="hero-download">
                    <div style="position: relative; z-index: 2;">
                        <h3><i class="fa-solid fa-rocket"></i></h3>
                        <h3 class="mb-2">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞!</h3>
                        <p class="muted mb-4">–°–∫–∞—á–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.</p>
                        
                        {% if download_url %}
                            <a href="{{ download_url }}" class="btn-cta px-5 py-3" style="font-size: 1.1rem;">
                                <i class="fa-brands fa-windows me-2"></i> –°–ö–ê–ß–ê–¢–¨ LAUNCHER
                            </a>
                            <div class="mt-3 small muted">–í–µ—Ä—Å–∏—è 1.0 ‚Ä¢ Windows 10/11 ‚Ä¢ x64</div>
                        {% else %}
                            <button class="btn-cta px-5 py-3 disabled" style="opacity: 0.6;">–°—Å—ã–ª–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</button>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <div class="panel-glass card text-center p-5 mb-4">
                    <h3 class="mb-3">üöÄ –ù–∞—á–Ω–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é</h3>
                    <p class="muted mb-4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏. –ü—Ä–∏–æ–±—Ä–µ—Ç–∏—Ç–µ –¥–æ—Å—Ç—É–ø, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FPBooster.</p>
                    <a href="/buy" class="btn-cta px-4 py-2">
                        <i class="fa-solid fa-cart-shopping me-2"></i> –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
                    </a>
                </div>
            {% endif %}

            <h4 class="mb-3 text-white"><i class="fa-solid fa-key me-2 text-muted"></i> –ú–æ–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏</h4>
            
            {% if licenses %}
                {% for lic in licenses %}
                    <div class="license-card {{ lic.status }}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <div class="muted small mb-1">–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á</div>
                                <div class="d-flex align-items-center gap-2">
                                    <div class="license-key" id="key_{{loop.index}}">{{ lic.license_key }}</div>
                                    <button class="btn btn-sm btn-outline-secondary border-0" onclick="navigator.clipboard.writeText('{{ lic.license_key }}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
                                        <i class="fa-regular fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-end">
                                {% if lic.status == 'active' %}
                                    <span class="badge bg-success text-white">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                {% elif lic.status == 'expired' %}
                                    <span class="badge bg-secondary">–ò—Å—Ç–µ–∫–ª–∞</span>
                                {% else %}
                                    <span class="badge bg-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-3 pt-3 border-top border-secondary border-opacity-25">
                            <div>
                                <div class="muted small">HWID (–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)</div>
                                <div style="color: #ddd;">
                                    {% if lic.hwid %}
                                        <i class="fa-solid fa-desktop text-success me-1"></i> –ü—Ä–∏–≤—è–∑–∞–Ω
                                    {% else %}
                                        <span class="text-muted">–û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞...</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="muted small">–ò—Å—Ç–µ–∫–∞–µ—Ç</div>
                                <div style="color: #fff; font-weight: 600;">
                                    {% if lic.expires %}{{ lic.expires.strftime("%d.%m.%Y") }}{% else %}‚Äî{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <div class="text-center muted py-4 border border-secondary border-opacity-25 rounded">
                    –£ –≤–∞—Å –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–π
                </div>
            {% endif %}

        </div>

        <div class="side-column">
            
            <div class="card mb-4">
                <h5 class="mb-3">üîë –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞</h5>
                <p class="muted small mb-3">–ï—Å—Ç—å –∫–æ–¥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è? –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –∑–¥–µ—Å—å.</p>
                <form method="post" action="/api/license/activate">
                    <div class="input-group mb-2">
                        <input type="text" name="token" class="form-control bg-dark text-white border-secondary" placeholder="TOKEN-XXXX-XXXX" required>
                        <button class="btn btn-primary" type="submit">OK</button>
                    </div>
                </form>
            </div>

            <div class="card mb-4">
                <h5 class="mb-3">–ú–µ–Ω—é</h5>
                <div class="action-btn-grid">
                    <a href="/buy" class="btn-action">
                        <i class="fa-solid fa-cart-plus"></i>
                        <span>–ü—Ä–æ–¥–ª–∏—Ç—å</span>
                    </a>
                    <a href="/purchases" class="btn-action">
                        <i class="fa-solid fa-history"></i>
                        <span>–ü–æ–∫—É–ø–∫–∏</span>
                    </a>
                    <a href="/creators/login" class="btn-action">
                        <i class="fa-solid fa-percentage"></i>
                        <span>–ü–∞—Ä—Ç–Ω–µ—Ä–∫–∞</span>
                    </a>
                    <a href="/change-password" class="btn-action">
                        <i class="fa-solid fa-lock"></i>
                        <span>–ü–∞—Ä–æ–ª—å</span>
                    </a>
                </div>
            </div>

            <div class="card bg-transparent border-0 p-0">
                <a href="/logout" class="btn btn-outline-danger w-100">
                    <i class="fa-solid fa-sign-out-alt me-2"></i> –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
                </a>
            </div>

        </div>
    </div>

</section>
{% endblock %}
