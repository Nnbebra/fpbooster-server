{% extends "base.html" %}
{% block content %}
<h2 class="mb-4 text-white">Управление пользователем: <span class="text-purple">{{ row.username }}</span></h2>

<div class="row">
    <div class="col-md-6">
        <div class="card-dark mb-4">
            <h4 class="mb-3 text-white">Основные настройки</h4>
            <form method="post" action="/admin/users/edit/{{ row.uid }}">
                <div class="mb-3">
                  <label class="form-label text-muted">Email (Login)</label>
                  <input type="text" class="form-control bg-dark text-white border-secondary" value="{{ row.email }}" readonly disabled>
                </div>

                <div class="mb-3">
                    <label class="form-label text-muted">Группа прав</label>
                    <select class="form-select bg-dark text-white border-secondary" name="user_group">
                        <option value="user" {% if row.user_group == 'user' %}selected{% endif %}>User</option>
                        <option value="premium" {% if row.user_group == 'premium' %}selected{% endif %}>Premium</option>
                        <option value="admin" {% if row.user_group == 'admin' %}selected{% endif %}>Admin</option>
                    </select>
                </div>
                
                <div class="mb-3 form-check">
                    <input class="form-check-input" type="checkbox" value="true" id="email_confirmed" name="email_confirmed" 
                           {% if row.email_confirmed %}checked{% endif %}>
                    <label class="form-check-label text-white" for="email_confirmed">Email подтвержден</label>
                </div>

                <hr class="border-secondary">
                
                <div class="mb-3">
                    <label class="form-label text-warning">Смена пароля</label>
                    <input type="text" class="form-control bg-dark text-white border-secondary" name="new_password" placeholder="Новый пароль (если нужно сменить)">
                </div>

                <button type="submit" class="btn btn-purple w-100">Сохранить изменения</button>
            </form>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card-dark mb-4">
            <h4 class="mb-3 text-white">Активная Лицензия</h4>
            {% if lic %}
                <div class="alert {% if lic.status == 'active' %}alert-success{% else %}alert-danger{% endif %}">
                    <strong>Статус:</strong> {{ lic.status|upper }}<br>
                    <strong>Истекает:</strong> {{ lic.expires }}<br>
                    <strong>HWID:</strong> {{ lic.hwid or "Не привязан" }}
                </div>
                <a href="/admin/licenses/edit/{{ lic.license_key }}" class="btn btn-outline-light btn-sm">Перейти к лицензии</a>
            {% else %}
                <p class="text-muted">У пользователя нет лицензии.</p>
                <a href="/admin/licenses/new" class="btn btn-outline-success btn-sm">Выдать лицензию</a>
            {% endif %}
        </div>

        <div class="card-dark">
            <h4 class="mb-3 text-white">История покупок</h4>
            {% if purchases %}
                <table class="table table-dark table-sm" style="font-size: 0.85rem;">
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Товар</th>
                            <th>Сумма</th>
                            <th>Метод</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in purchases %}
                        <tr>
                            <td>{{ p.created_at.strftime("%d.%m.%Y") }}</td>
                            <td>{{ p.plan }} дней</td>
                            <td class="text-success fw-bold">{{ p.amount }} {{ p.currency }}</td>
                            <td>{{ p.source }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">Покупок не найдено.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
