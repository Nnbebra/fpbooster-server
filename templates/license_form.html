{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">
  {% if row %}
    Редактирование подписки
  {% else %}
    Выдача новой подписки
  {% endif %}
</h2>

<div class="card-dark w-75 mx-auto">
  <form method="post"
        {% if row %}
          action="/admin/licenses/edit/{{ row.license_key }}"
        {% else %}
          action="/admin/licenses/new"
        {% endif %}>

    <div class="mb-3">
      <label class="form-label text-muted small">Системный ключ (License Key)</label>
      <input type="text" class="form-control bg-dark text-muted" style="border-color: #444;" id="license_key" name="license_key"
             value="{{ row.license_key if row else '' }}" {% if row %}readonly{% endif %} required>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="status" class="form-label">Статус</label>
            <select class="form-select" id="status" name="status" required>
                <option value="active" {% if row and row.status == "active" %}selected{% endif %}>Активна (Active)</option>
                <option value="expired" {% if row and row.status == "expired" %}selected{% endif %}>Истекла (Expired)</option>
                <option value="banned" {% if row and row.status == "banned" %}selected{% endif %}>Заблокирована (Banned)</option>
            </select>
        </div>
        <div class="col-md-6 mb-3">
            <label for="expires" class="form-label">Срок действия до</label>
            <input type="date" class="form-control" id="expires" name="expires"
                   value="{{ row.expires if row and row.expires else '' }}">
        </div>
    </div>

    <div class="card p-3 mb-3 bg-transparent border-secondary">
        <h5 class="text-white mb-3"><i class="fas fa-user"></i> Пользователь</h5>
        <div class="mb-3">
          <label for="user" class="form-label">Логин</label>
          <input type="text" class="form-control" id="user" name="user"
                 value="{{ row.user_name if row else '' }}">
        </div>

        <div class="mb-3">
          <label for="user_uid" class="form-label">UID (ID Аккаунта)</label>
          <input type="text" class="form-control" id="user_uid" name="user_uid"
                 value="{{ row.user_uid if row else '' }}" {% if row %}readonly{% endif %}>
        </div>
    </div>

    {% if row %}
    <div class="mb-3">
      <label class="form-label">Привязанное железо (HWID)</label>
      <div class="input-group">
          <input type="text" class="form-control" value="{{ row.hwid or 'Не привязан' }}" readonly>
          {% if row.hwid %}
            <a href="/admin/licenses/reset_hwid/{{ row.license_key }}" class="btn btn-outline-warning" onclick="return confirm('Сбросить HWID?')">
                <i class="fas fa-sync"></i> Сбросить
            </a>
          {% endif %}
      </div>
    </div>
    {% endif %}

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <div class="d-flex justify-content-between mt-4">
      <a href="/admin/licenses" class="btn btn-secondary-custom">
        <i class="fas fa-arrow-left"></i> Назад
      </a>
      <button type="submit" class="btn btn-purple">
        <i class="fas fa-save"></i> Сохранить
      </button>
    </div>
  </form>
</div>
{% endblock %}
