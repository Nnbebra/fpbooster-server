{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-white"><i class="fas fa-key text-purple"></i> –õ–∏—Ü–µ–Ω–∑–∏–∏</h2>
    <a href="/admin/licenses/new" class="btn btn-purple">
        <i class="fas fa-plus-circle"></i> –í—ã–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é
    </a>
</div>

<div class="card-dark mb-4">
  <form method="get" action="/admin/licenses" class="d-flex gap-2">
    <input type="text" class="form-control bg-dark text-white border-secondary" name="q" placeholder="üîç –ü–æ–∏—Å–∫..." value="{{ q }}">
    <button type="submit" class="btn btn-outline-light">–ù–∞–π—Ç–∏</button>
  </form>
</div>

<div class="card-dark p-0 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-dark table-hover mb-0 align-middle">
      <thead>
        <tr>
          <th style="color: #D6BCFA;">–í–ª–∞–¥–µ–ª–µ—Ü</th>
          <th style="color: #D6BCFA;">–°—Ç–∞—Ç—É—Å</th>
          <th style="color: #D6BCFA;">HWID</th>
          <th style="color: #D6BCFA;">–ü—Ä–æ–º–æ–∫–æ–¥</th>
          <th style="color: #D6BCFA;" class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td>
              <div class="fw-bold text-white" style="font-size: 1.05rem;">{{ row.user_name or "‚Äî" }}</div>
              <div style="color: #aaa; font-size: 0.9rem;">{{ row.email or "–ë–µ–∑ –ø–æ—á—Ç—ã" }}</div>
              <div class="small font-monospace" style="color: #555;">Key: {{ row.license_key[:8] }}...</div>
          </td>

          <td>
            {% if row.status == "active" %}
              <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–∞</span>
            {% elif row.status == "expired" %}
              <span class="badge bg-warning text-dark">–ò—Å—Ç–µ–∫–ª–∞</span>
            {% else %}
              <span class="badge bg-danger">–ë–∞–Ω</span>
            {% endif %}
            
            {% if row.expires %}
              <div class="mt-1 small" style="color: #D6BCFA;">
                 –¥–æ {{ row.expires.strftime('%d.%m.%y') }}
              </div>
            {% endif %}
          </td>

          <td>
              {% if row.hwid %}
                  <div class="d-flex align-items-center gap-2">
                      <code style="color: #facc15;">{{ row.hwid[:8] }}...</code>
                      <a href="/admin/licenses/reset_hwid/{{ row.license_key }}" 
                         class="btn btn-sm btn-outline-secondary py-0" 
                         onclick="return confirm('–°–±—Ä–æ—Å–∏—Ç—å HWID?')">
                         <i class="fas fa-sync-alt"></i>
                      </a>
                  </div>
              {% else %}
                  <span class="badge bg-secondary">Free</span>
              {% endif %}
          </td>

          <td>
              {% if row.promocode_used %}
                <span class="badge border border-info text-info">{{ row.promocode_used }}</span>
              {% else %}
                <span class="text-muted">-</span>
              {% endif %}
          </td>

          <td class="text-end">
            <a href="/admin/licenses/edit/{{ row.license_key }}" class="btn btn-sm btn-primary mb-1">
              <i class="fas fa-pen"></i>
            </a>
            <a href="/admin/licenses/delete/{{ row.license_key }}" class="btn btn-sm btn-danger mb-1"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å?')">
              <i class="fas fa-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
