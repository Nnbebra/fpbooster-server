{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Лицензии</h2>

<div class="d-flex justify-content-between align-items-center mb-4">
  <form method="get" action="/admin/licenses" class="d-flex w-50">
    <input type="text" class="form-control me-2" name="q" placeholder="Поиск по ключу/пользователю/UID" value="{{ q }}">
    <button type="submit" class="btn btn-purple">Искать</button>
  </form>
  <a href="/admin/licenses/new" class="btn btn-purple">
    <i class="fas fa-plus"></i> Создать лицензию
  </a>
</div>

<div class="card-dark">
  <table class="table table-dark table-striped table-hover rounded overflow-hidden mb-0">
    <thead>
      <tr>
        <th>Пользователь</th>
        <th>Статус</th>
        <th>Срок действия</th>
        <th>HWID</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>
            <div class="fw-bold text-white">{{ row.user_name or "—" }}</div>
            <div class="small text-muted">{{ row.email or "" }}</div>
            <div class="small text-muted" style="opacity:0.5">{{ row.license_key[:8] }}...</div>
        </td>
        <td>
          {% if row.status == "active" %}
            <span class="badge bg-success text-white">Активна</span>
          {% elif row.status == "expired" %}
            <span class="badge bg-warning text-dark">Истекла</span>
          {% else %}
            <span class="badge bg-danger text-white">Бан</span>
          {% endif %}
        </td>
        <td>
            {% if row.expires %}
                <span class="badge" style="background-color: #D6BCFA; color: #2D2D3A;">
                    до {{ row.expires }}
                </span>
            {% else %}
                <span class="text-muted">—</span>
            {% endif %}
        </td>
        <td>
            {% if row.hwid %}
                <code class="text-warning">{{ row.hwid[:8] }}...</code>
                <a href="/admin/licenses/reset_hwid/{{ row.license_key }}" class="text-decoration-none ms-2" title="Сброс HWID">
                    ❌
                </a>
            {% else %}
                <span class="text-muted small">Нет</span>
            {% endif %}
        </td>
        <td>
          <a href="/admin/licenses/edit/{{ row.license_key }}" class="btn btn-sm btn-purple">
            <i class="fas fa-edit"></i>
          </a>
          <a href="/admin/licenses/delete/{{ row.license_key }}" class="btn btn-sm btn-danger"
             onclick="return confirm('Удалить?')">
            <i class="fas fa-trash"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
