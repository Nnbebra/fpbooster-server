{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-key text-purple"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏</h2>
    <a href="/admin/licenses/new" class="btn btn-purple">
        <i class="fas fa-plus-circle"></i> –í—ã–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é
    </a>
</div>

<div class="card-dark mb-4">
  <form method="get" action="/admin/licenses" class="d-flex gap-2">
    <input type="text" class="form-control bg-dark text-light border-secondary" name="q" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á—É, –ª–æ–≥–∏–Ω—É, –ø–æ—á—Ç–µ –∏–ª–∏ UID" value="{{ q }}">
    <button type="submit" class="btn btn-outline-light">–ù–∞–π—Ç–∏</button>
  </form>
</div>

<div class="card-dark p-0 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-dark table-hover mb-0">
      <thead>
        <tr>
          <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>HWID (–ñ–µ–ª–µ–∑–æ)</th>
          <th>–õ–∏—Ü–µ–Ω–∑–∏—è</th>
          <th>–°–æ–∑–¥–∞–Ω–∞ / –í—Ö–æ–¥</th>
          <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td>
              <div class="fw-bold text-white" style="font-size: 1.05rem;">{{ row.user_name or "‚Äî" }}</div>
              <div class="small" style="color: #aaa;">{{ row.email or "–ë–µ–∑ –ø–æ—á—Ç—ã" }}</div>
              <div class="small text-muted font-monospace">UID: {{ row.user_uid or "?" }}</div>
          </td>

          <td>
            {% if row.status == "active" %}
              <span class="badge bg-success"><i class="fas fa-check-circle"></i> –ê–∫—Ç–∏–≤–Ω–∞</span>
            {% elif row.status == "expired" %}
              <span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> –ò—Å—Ç–µ–∫–ª–∞</span>
            {% else %}
              <span class="badge bg-danger"><i class="fas fa-ban"></i> –ë–∞–Ω</span>
            {% endif %}
            
            {% if row.expires %}
              <div class="mt-1 small" style="color: #D6BCFA;">
                 –¥–æ {{ row.expires.strftime('%d.%m.%Y') }}
              </div>
            {% endif %}
          </td>

          <td>
              {% if row.hwid %}
                  <div class="d-flex align-items-center gap-2">
                      <code class="text-warning" title="{{ row.hwid }}">{{ row.hwid[:10] }}...</code>
                      <a href="/admin/licenses/reset_hwid/{{ row.license_key }}" 
                         class="btn btn-sm btn-outline-secondary py-0" 
                         title="–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É"
                         onclick="return confirm('–°–±—Ä–æ—Å–∏—Ç—å HWID –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')">
                         <i class="fas fa-sync-alt"></i>
                      </a>
                  </div>
              {% else %}
                  <span class="badge bg-secondary">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</span>
              {% endif %}
          </td>

          <td>
              <code class="text-white-50">{{ row.license_key[:12] }}...</code>
          </td>

          <td>
              <div class="small text-white">{{ row.created_at.strftime("%d.%m.%Y") if row.created_at else "-" }}</div>
              <div class="small text-muted">–í—Ö–æ–¥: {{ row.last_check.strftime("%H:%M") if row.last_check else "-" }}</div>
          </td>

          <td class="text-end">
            <a href="/admin/licenses/edit/{{ row.license_key }}" class="btn btn-sm btn-primary mb-1" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
              <i class="fas fa-pen"></i>
            </a>
            <a href="/admin/licenses/delete/{{ row.license_key }}" class="btn btn-sm btn-danger mb-1"
               onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é –Ω–∞–≤—Å–µ–≥–¥–∞?')" title="–£–¥–∞–ª–∏—Ç—å">
              <i class="fas fa-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
