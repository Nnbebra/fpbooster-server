{% extends "account_base.html" %}
{% block title %}Оформление заказа — {{ plan.title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="/templates_css/checkout.css?v=final">

<main>
  <div class="checkout-card">
    
    <div class="checkout-header">
      <h2>Оформление заказа</h2>
      <div class="product-badge">{{ plan.title }}</div>
    </div>

    <span class="checkout-section-title">Выберите способ оплаты</span>
    <div class="payment-methods-grid" id="pm-list">
      
      <div class="pm-option active" data-method="card">
        <img src="/static/method_8.png" alt="Bank Card">
        <span>Банковская карта</span>
      </div>

      <div class="pm-option" data-method="crypto">
        <img src="/static/method_21.png" alt="Crypto">
        <span>Криптовалюта</span>
      </div>

    </div>

    <div class="price-container">
      <span class="price-label">Итого к оплате:</span>
      <div class="price-val">
        {% if plan.old_price %}
          <s>{{ plan.old_price }} ₽</s>
        {% endif %}
        <b>{{ plan.price }} ₽</b>
      </div>
    </div>

    <form id="pay-form" action="/payment/start" method="get">
      <input type="hidden" name="plan" value="{{ plan.id }}">
      <input type="hidden" name="method" value="card" id="pay-method-input">
      
      <button type="submit" class="btn-pay">
        <i class="fa-solid fa-lock"></i> Оплатить безопасно
      </button>
    </form>

    <a href="https://funpay.com/users/17156368/" target="_blank" class="btn-funpay">
      <span>Оплатить через</span>
      <img src="/static/funpay.png" alt="FunPay">
    </a>

    <div class="secure-note">
      <i class="fa-solid fa-shield-halved"></i>
      Ваши данные надежно защищены
    </div>

  </div>
</main>

<script>
  (function(){
    const pmList = document.getElementById('pm-list');
    const payMethodInput = document.getElementById('pay-method-input');
    
    if(pmList && payMethodInput) {
      pmList.addEventListener('click', (e) => {
        const pm = e.target.closest('.pm-option');
        if(!pm) return;
        
        pmList.querySelectorAll('.pm-option').forEach(el => el.classList.remove('active'));
        pm.classList.add('active');
        payMethodInput.value = pm.getAttribute('data-method') || 'card';
      });
    }
  })();
</script>
{% endblock %}
