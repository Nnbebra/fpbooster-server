{% extends "base.html" %}

{% block content %}

<style>
    .bg-purple { background-color: #6f42c1 !important; color: white; }
    .bg-indigo { background-color: #6610f2 !important; color: white; }
    .bg-pink   { background-color: #d63384 !important; color: white; }
    .bg-orange { background-color: #fd7e14 !important; color: white; }
    .bg-cyan   { background-color: #0dcaf0 !important; color: black; }
    .bg-azure  { background-color: #0d6efd !important; color: white; }
</style>

<div class="mb-4">
    <h2 class="text-white"><i class="fas fa-users text-purple"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
</div>

<div class="card-dark mb-4">
  <form method="get" action="/admin/users" class="d-flex gap-2">
    <input type="text" class="form-control bg-dark text-white border-secondary" name="q" placeholder="üîç –ü–æ–∏—Å–∫: Email, Login, UID" value="{{ q }}">
    <button type="submit" class="btn btn-outline-light">–ò—Å–∫–∞—Ç—å</button>
  </form>
</div>

<div class="card-dark p-0 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-dark table-hover mb-0 align-middle">
      <thead>
        <tr>
          <th style="color: #D6BCFA;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th style="color: #D6BCFA;">–ì—Ä—É–ø–ø–∞</th>
          <th style="color: #D6BCFA;">LTV (–ü–æ–∫—É–ø–∫–∏)</th>
          <th style="color: #D6BCFA;">–ò–Ω—Ñ–æ</th>
          <th style="color: #D6BCFA;" class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td>
              <div class="fw-bold text-white font-size-lg">{{ row.username or "–ë–µ–∑ –∏–º–µ–Ω–∏" }}</div>
              <div style="color: #b0b0b0; font-size: 0.9rem;">{{ row.email }}</div>
              <div class="small font-monospace" style="color: #666;">UID: {{ row.uid }}</div>
          </td>
          
          <td>
              <div class="mb-1">
                {% if row.group_slug %}
                    {% set badge_class = group_colors.get(row.group_slug, 'secondary') %}
                    <span class="badge bg-{{ badge_class }}">
                        {{ row.group_name|upper }}
                    </span>
                {% else %}
                    <span class="badge bg-secondary">USER</span>
                {% endif %}
              </div>
              <div>
                {% if row.email_confirmed %}
                    <span style="color: #4ade80; font-size: 0.85rem;"><i class="fas fa-check-circle"></i> Email OK</span>
                {% else %}
                    <span style="color: #f87171; font-size: 0.85rem;"><i class="fas fa-times-circle"></i> –ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                {% endif %}
              </div>
          </td>

          <td>
              {% if row.total_spent > 0 %}
                <span class="fw-bold text-success">+{{ row.total_spent }} ‚ÇΩ</span>
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
          </td>

          <td style="color: #b0b0b0; font-size: 0.9rem;">
              <div>–†–µ–≥: {{ row.created_at.strftime("%d.%m.%y") if row.created_at else "-" }}</div>
              <div>–í—Ö–æ–¥: {{ row.last_login.strftime("%d.%m %H:%M") if row.last_login else "-" }}</div>
          </td>

          <td class="text-end">
            <a href="/admin/users/edit/{{ row.uid }}" class="btn btn-sm btn-primary" title="–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ">
              <i class="fas fa-cog"></i>
            </a>
            <a href="/admin/users/delete/{{ row.uid }}" class="btn btn-sm btn-danger" 
               onclick="return confirm('–í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª–∏—Ç –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')"
               title="–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç">
              <i class="fas fa-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
