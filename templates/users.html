{% extends "base.html" %}
{% block content %}
<div class="mb-4">
    <h2><i class="fas fa-users text-purple"></i> Пользователи</h2>
</div>

<div class="card-dark mb-4">
  <form method="get" action="/admin/users" class="d-flex gap-2">
    <input type="text" class="form-control bg-dark text-light border-secondary" name="q" placeholder="Поиск: Email, Login, UID" value="{{ q }}">
    <button type="submit" class="btn btn-outline-light">Искать</button>
  </form>
</div>

<div class="card-dark p-0 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-dark table-hover mb-0 align-middle">
      <thead>
        <tr>
          <th>Пользователь</th>
          <th>Группа</th>
          <th>Email Статус</th>
          <th>Регистрация</th>
          <th>Вход</th>
          <th class="text-end">Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td>
              <div class="fw-bold text-white font-size-lg">{{ row.username or "Без имени" }}</div>
              <div class="small" style="color: #aaa;">{{ row.email }}</div>
              <div class="small text-muted font-monospace">UID: {{ row.uid }}</div>
          </td>
          
          <td>
              {% if row.user_group == 'admin' %}
                  <span class="badge bg-danger">ADMIN</span>
              {% elif row.user_group == 'premium' %}
                  <span class="badge bg-warning text-dark">PREMIUM</span>
              {% else %}
                  <span class="badge bg-secondary">USER</span>
              {% endif %}
          </td>

          <td>
              {% if row.email_confirmed %}
                  <span class="text-success small"><i class="fas fa-check-circle"></i> Подтвержден</span>
              {% else %}
                  <span class="text-danger small"><i class="fas fa-times-circle"></i> Не подтвержден</span>
              {% endif %}
          </td>

          <td>{{ row.created_at.strftime("%d.%m.%Y") if row.created_at else "—" }}</td>
          <td>{{ row.last_login.strftime("%d.%m %H:%M") if row.last_login else "—" }}</td>

          <td class="text-end">
            <a href="/admin/users/edit/{{ row.uid }}" class="btn btn-sm btn-primary" title="Настройки аккаунта">
              <i class="fas fa-cog"></i>
            </a>
            <a href="/admin/users/delete/{{ row.uid }}" class="btn btn-sm btn-danger" 
               onclick="return confirm('ВНИМАНИЕ: Удаление пользователя удалит все его покупки и лицензии! Продолжить?')"
               title="Удалить аккаунт">
              <i class="fas fa-user-times"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
