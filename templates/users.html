{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Управление пользователями</h2>

<div class="d-flex justify-content-between align-items-center mb-4">
  <form method="get" action="/admin/users" class="d-flex w-50">
    <input type="text" class="form-control me-2" name="q" placeholder="Поиск по email / логину / UID" value="{{ q }}">
    <button type="submit" class="btn btn-purple">Искать</button>
  </form>
</div>

<div class="card-dark">
  <table class="table table-dark table-striped table-hover rounded overflow-hidden mb-0 align-middle">
    <thead>
      <tr>
        <th>Пользователь / Email</th>
        <th>UID</th>
        <th>Группа</th>
        <th>Статус Email</th>
        <th>Дата регистрации</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>
            <div class="fw-bold text-white">{{ row.username or "—" }}</div>
            <div class="text-muted small">{{ row.email }}</div>
        </td>
        <td><code class="text-info">{{ row.uid }}</code></td>
        <td>
            {% if row.user_group == 'admin' %}
                <span class="badge bg-danger">ADMIN</span>
            {% elif row.user_group == 'premium' %}
                <span class="badge bg-warning text-dark">PREMIUM</span>
            {% else %}
                <span class="badge bg-secondary">USER</span>
            {% endif %}
        </td>
        <td>
            {% if row.email_confirmed %}
                <span class="badge bg-success"><i class="fas fa-check"></i> Подтвержден</span>
            {% else %}
                <span class="badge bg-secondary"><i class="fas fa-times"></i> Нет</span>
            {% endif %}
        </td>
        <td>
            <div class="small">{{ row.created_at.strftime("%d.%m.%Y") if row.created_at else "—" }}</div>
            <div class="small text-muted">{{ row.last_login.strftime("%H:%M") if row.last_login else "" }}</div>
        </td>
        <td>
          <a href="/admin/users/edit/{{ row.uid }}" class="btn btn-sm btn-purple me-1" title="Редактировать">
            <i class="fas fa-edit"></i>
          </a>
          <a href="/admin/users/delete/{{ row.uid }}" class="btn btn-sm btn-danger" 
             onclick="return confirm('Вы уверены? Это удалит пользователя, все его лицензии и покупки безвозвратно!')"
             title="Удалить аккаунт">
            <i class="fas fa-trash-alt"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
