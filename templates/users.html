{% extends "base.html" %}

{% block content %}

<style>
    .bg-purple { background-color: #6f42c1 !important; color: white; }
    .bg-indigo { background-color: #6610f2 !important; color: white; }
    .bg-pink   { background-color: #d63384 !important; color: white; }
    .bg-alpha  { background-color: #0dcaf0 !important; color: black; font-weight: bold; }
    .bg-plus   { background-color: #0d6efd !important; color: white; }
    .bg-basic  { background-color: #198754 !important; color: white; }
</style>

<div class="mb-4">
    <h2 class="text-white"><i class="fas fa-users text-purple"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
</div>

<div class="card-dark mb-4">
  <form method="get" action="/admin/users" class="d-flex gap-2">
    <input type="text" class="form-control bg-dark text-white border-secondary" name="q" placeholder="üîç –ü–æ–∏—Å–∫: Email, Login, UID" value="{{ q }}">
    <button type="submit" class="btn btn-outline-light">–ò—Å–∫–∞—Ç—å</button>
  </form>
</div>

<div class="card-dark p-0 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-dark table-hover mb-0 align-middle">
      <thead>
        <tr>
          <th class="ps-3 text-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th class="text-muted">–ì—Ä—É–ø–ø–∞ (–ü–æ–¥–ø–∏—Å–∫–∞)</th>
          <th class="text-muted">–ë–∞–ª–∞–Ω—Å</th>
          <th class="text-muted">–ò–Ω—Ñ–æ</th>
          <th class="text-end pe-3 text-muted">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr>
          <td class="ps-3">
              <div class="fw-bold text-white">{{ row.username }}</div>
              <div class="text-muted small">{{ row.email }}</div>
              <div class="text-muted small" style="font-size: 0.75rem;">UID: {{ row.uid }}</div>
          </td>

          <td>
              {% if row.group_slug %}
                <span class="badge bg-{{ group_colors.get(row.group_slug, 'secondary') }} fs-6">
                    {{ row.group_name }}
                </span>
              {% else %}
                <span class="badge bg-secondary">User</span>
              {% endif %}
              
              <div class="mt-1">
                {% if row.email_confirmed %}
                    <i class="fas fa-check-circle text-success" title="Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"></i>
                {% else %}
                    <i class="fas fa-exclamation-circle text-danger" title="Email –ù–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"></i>
                {% endif %}
              </div>
          </td>

          <td>
              {% if row.total_spent > 0 %}
                <span class="fw-bold text-success">+{{ row.total_spent }} ‚ÇΩ</span>
              {% else %}
                <span class="text-muted">-</span>
              {% endif %}
          </td>

          <td class="small text-muted">
              <div>–†–µ–≥: {{ row.created_at.strftime("%d.%m.%y") if row.created_at else "-" }}</div>
              <div>–í—Ö–æ–¥: {{ row.last_login.strftime("%d.%m") if row.last_login else "-" }}</div>
          </td>

          <td class="text-end pe-3">
            <a href="/admin/users/edit/{{ row.uid }}" class="btn btn-sm btn-primary mb-1" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ">
              <i class="fas fa-cog"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
